<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>SenaLink - Crear Empresa</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=menu" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=account_circle" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- <link rel="stylesheet" href="../../css/crud.css"> -->
    <link rel="stylesheet" href="../../css/alert.css">
    <link rel="stylesheet" href="../../css/components/gov.css">
    <link rel="stylesheet" href="../../css/components/buttons.css">
    <link rel="stylesheet" href="../../css/layouts/Form_layout.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="shortcut icon " href="../../../img/Favicon1.png"> <!-- corresponde al favicon en la pestaña -->
</head>
<body>
    <header class="gov" id="inicio">
        <div class="gov__container">
            <a href="https://www.gov.co/" target="_blank">
                <img loading="lazy" src="../../img/gov-logo.svg" alt="Logo de la pagina gov.co" class="gov__img">
            </a>
        </div>
    </header>
    <div class="container">
        <main class="container__crud">
        <img alt="SenaLink Logo" src="../../img/logo-proyecto1.png" class="logo__senalink"/>

        <!-- FORMULARIO DE REGISTRO -->
        <form action="../../controllers/UsuarioController.php" method="POST" class="form-layout">
            <input type="hidden" name="accion" value="crearUsuario" />

            <div class="form-group">
            <label for="nit">Número NIT</label>
            <input id="nit" class="input-field" name="nit" type="number" required/>
            </div>

            <div class="form-group">
            <label for="representante">Representante legal</label>
            <input id="representante" class="input-field" name="representante_legal" type="text" required/>
            </div>

            <div class="form-group">
            <label for="razon">Razón social</label>
            <input id="razon" class="input-field" name="razon_social" type="text" required/>
            </div>

            <div class="form-group">
            <label for="telefono">Número telefónico</label>
            <input id="telefono" class="input-field" name="telefono" type="number" required/>
            </div>

            <div class="form-group">
            <label for="correo">Correo electrónico</label>
            <input id="correo" class="input-field" name="correo" type="email" required/>
            </div>

            <div class="form-group">
            <label for="direccion">Dirección</label>
            <input id="direccion" class="input-field" name="direccion" type="text" required/>
            </div>

            <!-- Nuevo campo Barrio -->
            <div class="form-group">
            <label for="barrio">Barrio</label>
            <input id="barrio" class="input-field" name="barrio" type="text" required/>
            </div>

            <div class="form-group">
                <label for="departamentos">Departamento(s)</label>
                <select id="departamento" name="departamento" class="select_container" required>
                    <option value="Amazonas">Amazonas</option>
                    <option value="Antioquia">Antioquia</option>
                    <option value="Arauca">Arauca</option>
                    <option value="Atlántico">Atlántico</option>
                    <option value="Bogotá D.C.">Bogotá D.C.</option>
                    <option value="Bolívar">Bolívar</option>
                    <option value="Boyacá">Boyacá</option>
                    <option value="Caldas">Caldas</option>
                    <option value="Caquetá">Caquetá</option>
                    <option value="Casanare">Casanare</option>
                    <option value="Cauca">Cauca</option>
                    <option value="Cesar">Cesar</option>
                    <option value="Chocó">Chocó</option>
                    <option value="Córdoba">Córdoba</option>
                    <option value="Cundinamarca">Cundinamarca</option>
                    <option value="Guainía">Guainía</option>
                    <option value="Guaviare">Guaviare</option>
                    <option value="Huila">Huila</option>
                    <option value="La Guajira">La Guajira</option>
                    <option value="Magdalena">Magdalena</option>
                    <option value="Meta">Meta</option>
                    <option value="Nariño">Nariño</option>
                    <option value="Norte de Santander">Norte de Santander</option>
                    <option value="Putumayo">Putumayo</option>
                    <option value="Quindío">Quindío</option>
                    <option value="Risaralda">Risaralda</option>
                    <option value="San Andrés y Providencia">San Andrés y Providencia</option>
                    <option value="Santander">Santander</option>
                    <option value="Sucre">Sucre</option>
                    <option value="Tolima">Tolima</option>
                    <option value="Valle del Cauca">Valle del Cauca</option>
                    <option value="Vaupés">Vaupés</option>
                    <option value="Vichada">Vichada</option>
                    <!-- Agrega más departamentos según necesites -->
                </select>
            </div>
            <!-- Selector múltiple de Ciudades -->
            <div class="form-group">
                <label for="ciudades">Ciudad(es)</label>
                <select id="ciudad" name="ciudad" class="select_container" required>
                    <!-- Opciones se llenan dinámicamente -->
                </select>
            </div>

            <div class="form-group">
            <label for="tipo_empresa">Sector Económico</label>
            <select id="tipo_empresa" class="select_container" name="tipo_empresa" required>
                <option selected disabled>Selecciona un sector</option>
                <option>Industrial</option>
                <option>Servicios</option>
            </select>
            </div>

            <div class="form-group">
            <label for="contrasena">Contraseña</label>
            <div class="password-box">
                <input id="contrasena" class="input-field" name="contrasena" type="password" 
                    pattern=".{12,}" title="La contraseña debe tener al menos 12 caracteres" required />
                <button type="button" id="togglePassword" class="toggle-btn">
                <img class="icon__pass" id="viewPassword" src="../../img/icons8-invisible-24.png" alt="Ver contraseña">
                </button>
            </div>
            </div>

            <input type="hidden" name="rol" value="empresa" required/>
            <div class="btn__container">
            <button type="submit" class="btn">Crear</button>
            <button onclick="goBack()" type="button" class="btn">Volver</button>
            </div>
        </form>
        </main>

        </div>
        <script src="../../js/backbutton.js"></script>
        <script src="../../js/control_inactividad.js"></script>
        <script src="../../js/alert.js"></script>
        <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Mostrar/ocultar contraseña
            const passwordInput = document.querySelector('input[name="contrasena"]');
            const toggleButton = document.querySelector(".password-box button");
            const eyeIcon = document.getElementById("viewPassword");
            if (toggleButton) {
                toggleButton.addEventListener("click", function (e) {
                    e.preventDefault();
                    const isPassword = passwordInput.type === "password";
                    passwordInput.type = isPassword ? "text" : "password";
                    eyeIcon.src = isPassword 
                        ? "../../img/icons8-eye-24.png"
                        : "../../img/icons8-invisible-24.png";
                });
            }

            // Manejo del formulario con AJAX para mostrar errores con showAlert y redirigir a index.html
            const form = document.querySelector('form[action*="UsuarioController.php"]');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(form);
                    fetch(form.action, {
                        method: 'POST',
                        body: formData
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            showAlert('Empresa creada exitosamente', 'success');
                            setTimeout(() => { window.location.href = '../index.php'; }, 1500);
                        } else if (data.errors && data.errors.length) {
                            showAlert(data.errors[0], 'error');
                        } else {
                            showAlert('Ocurrió un error inesperado', 'error');
                        }
                    })
                    .catch(() => {
                        showAlert('Error de conexión con el servidor', 'error');
                    });
                });
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
        // Mapa de departamentos y sus ciudades (ejemplo simplificado)
        const departamentosCiudades = {       
        "Amazonas": ["Leticia", "Puerto Nariño"],
        "Antioquia": ["Medellín", "Bello", "Itagüí", "Envigado", "Rionegro", "Turbo", "Apartadó", "La Ceja", "Sabaneta", "Copacabana", "Girardota", "Marinilla"],
        "Arauca": ["Arauca", "Arauquita", "Saravena", "Tame", "Fortul"],
        "Atlántico": ["Barranquilla", "Soledad", "Malambo", "Puerto Colombia", "Sabanalarga"],
        "Bogotá D.C.": ["Bogotá"],
        "Bolívar": ["Cartagena", "Magangué", "Turbaco", "Arjona", "San Juan Nepomuceno", "El Carmen de Bolívar"],
        "Boyacá": ["Tunja", "Duitama", "Sogamoso", "Chiquinquirá", "Paipa", "Puerto Boyacá"],
        "Caldas": ["Manizales", "Villamaría", "Chinchiná", "La Dorada"],
        "Caquetá": ["Florencia", "San Vicente del Caguán", "Puerto Rico", "El Doncello"],
        "Casanare": ["Yopal", "Aguazul", "Villanueva", "Monterrey", "Tauramena"],
        "Cauca": ["Popayán", "Santander de Quilichao", "Puerto Tejada", "Patía", "Miranda"],
        "Cesar": ["Valledupar", "Aguachica", "Bosconia", "Curumaní", "La Jagua de Ibirico"],
        "Chocó": ["Quibdó", "Istmina", "Condoto", "Bahía Solano", "Acandí"],
        "Córdoba": ["Montería", "Cereté", "Lorica", "Sahagún", "Tierralta", "Planeta Rica"],
        "Cundinamarca": ["Soacha", "Zipaquirá", "Girardot", "Facatativá", "Fusagasugá", "Chía", "Mosquera", "Cajicá", "Funza", "Madrid"],
        "Guainía": ["Inírida"],
        "Guaviare": ["San José del Guaviare"],
        "Huila": ["Neiva", "Pitalito", "Garzón", "La Plata"],
        "La Guajira": ["Riohacha", "Maicao", "Uribia", "Fonseca", "San Juan del Cesar"],
        "Magdalena": ["Santa Marta", "Ciénaga", "Fundación", "Plato", "Aracataca"],
        "Meta": ["Villavicencio", "Acacías", "Granada", "Puerto López", "Cumaral"],
        "Nariño": ["Pasto", "Ipiales", "Tumaco", "Túquerres"],
        "Norte de Santander": ["Cúcuta", "Ocaña", "Pamplona", "Villa del Rosario", "Los Patios"],
        "Putumayo": ["Mocoa", "Puerto Asís", "Orito", "Villagarzón"],
        "Quindío": ["Armenia", "Calarcá", "La Tebaida", "Montenegro", "Quimbaya"],
        "Risaralda": ["Pereira", "Dosquebradas", "Santa Rosa de Cabal", "La Virginia"],
        "San Andrés y Providencia": ["San Andrés", "Providencia"],
        "Santander": ["Bucaramanga", "Floridablanca", "Giron", "Piedecuesta", "Barrancabermeja", "Socorro", "San Gil"],
        "Sucre": ["Sincelejo", "Corozal", "Sampués", "Tolú", "San Marcos"],
        "Tolima": ["Ibagué", "Espinal", "Melgar", "Honda", "Mariquita"],
        "Valle del Cauca": ["Cali", "Palmira", "Buenaventura", "Tuluá", "Buga", "Cartago", "Jamundí", "Yumbo"],
        "Vaupés": ["Mitú"],
        "Vichada": ["Puerto Carreño"]


            // Agrega más departamentos y ciudades según necesites
        };

        const departamentosSelect = document.getElementById("departamento");
        const ciudadesSelect = document.getElementById("ciudad");

        function actualizarCiudades() {
            // Obtener departamentos seleccionados
            const seleccionados = Array.from(departamentosSelect.selectedOptions).map(opt => opt.value);

            // Limpiar opciones actuales de ciudades
            ciudadesSelect.innerHTML = "";

            // Crear un Set para evitar ciudades duplicadas si hay varios departamentos seleccionados
            const ciudadesSet = new Set();

            // Agregar ciudades de los departamentos seleccionados
            seleccionados.forEach(depto => {
                const ciudades = departamentosCiudades[depto] || [];
                ciudades.forEach(ciudad => ciudadesSet.add(ciudad));
            });

            // Agregar opciones al select de ciudades
            ciudadesSet.forEach(ciudad => {
                const option = document.createElement("option");
                option.value = ciudad;
                option.textContent = ciudad;
                ciudadesSelect.appendChild(option);
            });

            // Si no hay departamentos seleccionados, deshabilitar ciudades
            ciudadesSelect.disabled = seleccionados.length === 0;
        }

        // Inicializar ciudades deshabilitadas
        ciudadesSelect.disabled = true;

        // Escuchar cambios en departamentos
        departamentosSelect.addEventListener("change", actualizarCiudades);
    });
    </script>
</body>
</html>
